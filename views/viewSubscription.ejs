<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Your Subscription | Rally AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .pricing-card { border-radius: 15px; transition: 0.3s; border: none; overflow: hidden; height: 100%; }
    .pricing-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .confirm-box { background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 12px; padding: 20px; margin-top: 15px; }
  </style>
</head>
<body class="bg-light">
  <%- include('partials/navbar.ejs') %>

  <div class="container py-5">
    
    <div class="row justify-content-center mb-5">
      <div class="col-md-8">
        
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
          <div class="card-header bg-dark text-white p-4 text-center">
             <h2 class="mb-0"><%= subscription.plan_name %> Plan</h2>
             <span class="badge bg-success mt-2"><%= subscription.status %></span>
          </div>
          
          <div class="card-body p-5">
            <div class="row text-center mb-4">
               <div class="col-6">
                 <h6 class="text-muted">Remaining Credits</h6>
                 <h1 class="fw-bold text-primary"><%= subscription.credit %></h1>
               </div>
               <div class="col-6">
                 <h6 class="text-muted">Generation Limit</h6>
                 <h1 class="fw-bold"><%= subscription.ai_generation_limit %></h1>
               </div>
            </div>

            <hr>

            <ul class="list-group list-group-flush my-4">
              <li class="list-group-item d-flex justify-content-between align-items-center">
                 <strong><i class="fas fa-calendar-alt me-2 text-muted"></i> Start Date:</strong>
                 <span><%= new Date(subscription.start_date).toDateString() %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                 <strong><i class="fas fa-hourglass-end me-2 text-muted"></i> Expiration Date:</strong>
                 <span><%= subscription.end_date ? new Date(subscription.end_date).toDateString() : 'Lifetime' %></span>
              </li>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                 <strong><i class="fas fa-layer-group me-2 text-muted"></i> Template Access:</strong>
                 <span class="badge bg-info text-dark"><%= subscription.template_access %></span>
              </li>
            </ul>

            <div class="d-grid gap-2">
              <a href="/chat" class="btn btn-primary btn-lg rounded-pill">Go to Video Generation</a>
              <a href="/" class="btn btn-outline-secondary rounded-pill">Back to homepage</a>
            </div>

          </div>
        </div>

      </div>
    </div>

    <hr class="my-5">

    <div class="text-center mb-5">
        <h3 class="fw-bold">Other Available Plans</h3>
        <p class="text-muted">Upgrade or switch your plan below.</p>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
        <% if(plans) { plans.forEach(plan => { %>
            <div class="col">
                <div class="card pricing-card shadow-sm <%= plan.name === 'Personal' ? 'border-primary' : '' %>">
                    <div class="card-body p-4 text-center">
                        
                        <% if(plan.name === 'Personal') { %>
                            <div class="badge bg-primary mb-2">Most Popular</div>
                        <% } %>

                        <h4 class="fw-bold"><%= plan.name %></h4>
                        <h2 class="my-3">$<%= plan.price %> <small class="text-muted fs-6">/<%= plan.billing %></small></h2>
                        
                        <ul class="list-unstyled text-muted small mb-4">
                            <li><strong><%= plan.credit %></strong> Credits</li>
                            <li><strong><%= plan.limit %></strong> Generations/mo</li>
                            <li><%= plan.template %> Access</li>
                        </ul>

                        <button class="btn <%= plan.name === 'Personal' ? 'btn-primary' : 'btn-outline-dark' %> rounded-pill w-100 fw-bold" 
                                type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#planForm<%= plan.id %>">
                            Select <%= plan.name %>
                        </button>
                        
                        <div class="collapse mt-3" id="planForm<%= plan.id %>">
                            <div class="confirm-box text-start">
                                <form action="/subscribe" method="POST">
                                    <input type="hidden" name="planId" value="<%= plan.id %>">
                                    
                                    <label class="form-label small fw-bold">Duration:</label>
                                    <select name="months" class="form-select form-select-sm mb-3">
                                        <option value="1">1 Month</option>
                                        <option value="3">3 Months</option>
                                        <option value="12">1 Year</option>
                                    </select>
                                    
                                    <button type="submit" class="btn btn-success btn-sm w-100 fw-bold">
                                        Confirm Purchase
                                    </button>
                                </form>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        <% }); } %>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>